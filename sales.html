<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sales Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
<style>
body { margin:0; font-family:'Segoe UI',sans-serif; background:#f0f2f5; }
/* Sidebar */
.sidebar {
    position: fixed; top:0; left:0; height:100vh; width:220px;
    background: linear-gradient(180deg, #000000ff, #000000ff);
    padding-top:18px; overflow-x:hidden; z-index:1000;
}
.sidebar a {
    display:flex; align-items:center; gap:12px;
    padding:14px 20px; color:#d1d1d1; text-decoration:none; font-size:15px;
}
.sidebar a i { font-size:18px; }
.sidebar a:hover, .sidebar .active { background:#ff6b6b; color:#fff; }
.sidebar .nav-text { opacity:1; white-space:nowrap; }
/* Topbar */
.topbar { margin-left:220px; background: linear-gradient(90deg, #ffffff, #e9ecef); padding:14px 20px; box-shadow:0 3px 10px rgba(0,0,0,0.08); display:flex; justify-content:space-between; align-items:center; z-index:900; }
/* Content */
.content { margin-left:220px; padding:20px; }
/* Cards */
.stat-card { border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:20px; text-align:center; }
.card { border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.08); padding:20px; transition:transform .3s, box-shadow .3s; }
.card:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.12); }
.low-stock { color:red; font-weight:bold; }
/* Responsive */
@media (max-width:992px) { .sidebar{width:220px; position:relative;} .topbar,.content{margin-left:0;} }
</style>
</head>
<body>

<!-- Sidebar -->
<div class="sidebar">
    <a href="dashboard.html"><i class="bi bi-grid"></i><span class="nav-text">Dashboard</span></a>
    <a href="inventory.html"><i class="bi bi-box"></i><span class="nav-text">Inventory</span></a>
    <a class="active" href="#"><i class="bi bi-cart"></i><span class="nav-text">Sales</span></a>
    <a href="purchases.html"><i class="bi bi-truck"></i><span class="nav-text">Purchases</span></a>
    <a href="reports.html"><i class="bi bi-file-earmark-text"></i><span class="nav-text">Reports</span></a>
    <a href="index.html"><i class="bi bi-box-arrow-right"></i><span class="nav-text">Logout</span></a>
</div>

<!-- Topbar -->
<div class="topbar">
    <h5 class="m-0">Sales Dashboard</h5>
    <small class="text-muted">Record and track sales</small>
</div>

<!-- Main content -->
<div class="content container-fluid">
    <!-- Stats -->
    <div class="row g-3 mb-4">
        <div class="col-md-3"><div class="stat-card stat-sales"><h6>Total Sales</h6><h2 id="totalSalesCount">0</h2></div></div>
        <div class="col-md-3"><div class="stat-card stat-total"><h6>Total Revenue (RM)</h6><h2 id="totalRevenue">0.00</h2></div></div>
    </div>
    <div class="row g-4">
        <!-- Sales Table -->
        <div class="col-lg-8">
            <div class="table-container">
                <h5 class="mb-3">All Sales</h5>
                <div class="table-responsive">
                    <table class="table table-hover align-middle" id="salesTable">
                        <thead class="table-light">
                            <tr>
                                <th>Sale ID</th><th>Product</th><th>Qty</th><th>Price (RM)</th><th>Total (RM)</th><th>Date</th><th>Actions</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <!-- Add Sale Form -->
        <div class="col-lg-4">
            <div class="card">
                <h5 class="mb-3">Add New Sale</h5>
                <form id="addSaleForm">
                    <div class="mb-3">
                        <label class="form-label">Product</label>
                        <select id="productSelect" class="form-select" required>
                            <option value="">-- Select product --</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Quantity</label>
                        <input type="number" id="quantityInput" class="form-control" min="1" disabled>
                        <div id="stockHelp" class="form-text text-muted">Select a product to set max quantity.</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Price (RM)</label>
                        <input type="text" id="priceInput" class="form-control" readonly>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Total (RM)</label>
                        <input type="text" id="totalInput" class="form-control" readonly>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Add Sale</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
let inventory = [
    {id:"P001", name:"Daun Bawang", category:"Breakfast", stock:50, price:12.5},
    {id:"P002", name:"Ikan Siakap", category:"Lunch", stock:8, price:20.0},
    {id:"P003", name:"Nasi Impit", category:"Event", stock:2, price:30.0},
    {id:"P004", name:"Ayam", category:"Ramadhan - Iftar", stock:20, price:16.99},
    {id:"P005", name:"Coffee Beans", category:"Ramadhan - Moreh", stock:2, price:35.9}
];

let sales = [];

const productSelect = document.getElementById('productSelect');
const quantityInput = document.getElementById('quantityInput');
const priceInput = document.getElementById('priceInput');
const totalInput = document.getElementById('totalInput');
const stockHelp = document.getElementById('stockHelp');
const salesTableBody = document.querySelector('#salesTable tbody');
const totalSalesCount = document.getElementById('totalSalesCount');
const totalRevenue = document.getElementById('totalRevenue');

// Populate product select
function populateProducts(){
    productSelect.innerHTML = '<option value="">-- Select product --</option>';
    inventory.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.id;
        opt.textContent = `${item.name} (Stock: ${item.stock})`;
        opt.dataset.price = item.price;
        opt.dataset.stock = item.stock;
        productSelect.appendChild(opt);
    });
}

populateProducts();

// Update price & stock when product changes
productSelect.addEventListener('change', ()=>{
    const opt = productSelect.options[productSelect.selectedIndex];
    if(!opt || !opt.value){
        priceInput.value=''; totalInput.value=''; quantityInput.value=''; quantityInput.disabled=true; quantityInput.removeAttribute('max'); stockHelp.textContent='Select a product to set max quantity.'; return;
    }
    const price = parseFloat(opt.dataset.price);
    const stock = parseInt(opt.dataset.stock);
    priceInput.value = price.toFixed(2);
    quantityInput.value = '';
    totalInput.value='';
    quantityInput.disabled=false;
    quantityInput.max=stock;
    quantityInput.placeholder='Max: '+stock;
    stockHelp.textContent='Available stock: '+stock;
});

quantityInput.addEventListener('input', ()=>{
    const qty = parseInt(quantityInput.value) || 0;
    const max = parseInt(quantityInput.max);
    const price = parseFloat(priceInput.value);
    if(qty>max){ totalInput.value='Exceeds stock'; }
    else if(qty<=0){ totalInput.value=''; }
    else{ totalInput.value=(qty*price).toFixed(2); }
});

function updateStats(){
    totalSalesCount.textContent = sales.length;
    totalRevenue.textContent = sales.reduce((acc,s)=>acc+s.total,0).toFixed(2);
}

function renderSalesTable(){
    salesTableBody.innerHTML='';
    sales.slice().reverse().forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.sale_id}</td><td>${s.product_name}</td><td>${s.quantity}</td><td>${s.price.toFixed(2)}</td><td>${s.total.toFixed(2)}</td><td>${s.date}</td>
        <td><button class="btn btn-sm btn-danger" onclick="deleteSale('${s.sale_id}')">Delete</button></td>`;
        salesTableBody.appendChild(tr);
    });
    updateStats();
}

function deleteSale(id){
    const idx = sales.findIndex(s=>s.sale_id===id);
    if(idx>-1){
        const sale = sales[idx];
        const invItem = inventory.find(i=>i.id===sale.product_id);
        if(invItem) invItem.stock += sale.quantity;
        sales.splice(idx,1);
        populateProducts();
        renderSalesTable();
    }
}

function generateSaleId(){
    return 'S'+String(sales.length+1).padStart(4,'0');
}

document.getElementById('addSaleForm').addEventListener('submit', e=>{
    e.preventDefault();
    const productId = productSelect.value;
    const qty = parseInt(quantityInput.value);
    if(!productId){ alert('Select a product'); return; }
    const product = inventory.find(i=>i.id===productId);
    if(!product || qty>product.stock || qty<=0){ alert('Invalid quantity'); return; }
    const price = product.price;
    const total = price*qty;
    const sale = {sale_id:generateSaleId(), product_id:product.id, product_name:product.name, quantity:qty, price:price, total:total, date: new Date().toLocaleString()};
    sales.push(sale);
    product.stock -= qty;
    populateProducts();
    renderSalesTable();
    e.target.reset();
    priceInput.value=''; totalInput.value=''; quantityInput.disabled=true; stockHelp.textContent='Select a product to set max quantity.';
});
</script>
</body>
</html>
